# FutureLenz - راه‌اندازی و توسعه

این مخزن شامل نسخه MVP پلتفرم FutureLenz با بک‌اند Fastify (Node.js/TypeScript) و فرانت‌اند Next.js (RTL، تمام متون فارسی) است.

## پیش‌نیازها
- Node.js 20+
- npm یا pnpm
- Docker و docker-compose (اختیاری برای اجرا با کانتینر)

## متغیرهای محیطی
نمونه در `.env.example` قرار می‌گیرد. مقادیر کلیدی:
- `PORT`: پورت سرویس بک‌اند (پیش‌فرض 3001)
- `FRONTEND_PORT`: پورت فرانت‌اند (پیش‌فرض 3000)
- `DATABASE_FILE`: مسیر فایل SQLite (مثلاً `./data/futurelenz.db`)
- `LLM_PROVIDER`: نام ارائه‌دهنده (مثلاً `openai`)
- `LLM_MODEL`: نام مدل (مثلاً `gpt-4o-mini`)
- `LLM_API_KEY`: کلید LLM (در صورت خالی بودن، حالت Demo فعال می‌شود)
- `LOG_LEVEL`: سطح لاگ (مثلاً `info`)
- `RATE_LIMIT_MAX`: تعداد درخواست مجاز در بازه
- `RATE_LIMIT_WINDOW_MS`: بازه زمانی ریت‌لیمیت بر حسب میلی‌ثانیه

## نصب وابستگی‌ها
```
cd backend
npm install
cd ../frontend
npm install
```

## اجرای توسعه
ترمینال ۱ (بک‌اند):
```
cd backend
npm run dev
```

ترمینال ۲ (فرانت‌اند):
```
cd frontend
npm run dev
```

## تست‌ها
در مسیر بک‌اند:
```
cd backend
npm test
```
(تست‌های واحد برای اعتبارسنجی اسکیما و ارکستریشن؛ در ادامه اضافه می‌شود)

## Docker / docker-compose
اجرای همزمان بک‌اند و فرانت‌اند:
```
docker-compose up --build
```
فایل دیتا در ولوم محلی ذخیره می‌شود و با توقف کانتینر باقی می‌ماند.

## حالت Demo
اگر `LLM_API_KEY` تنظیم نشود، سرویس به صورت Demo پاسخ‌های ساختگی اما معقول تولید می‌کند و تمام خروجی‌ها با برچسب «دمو» مشخص می‌شوند.

## ساختار پوشه‌ها (خلاصه)
- `backend/`: کد Fastify، ماژول‌های 0 تا 8، ارکستراتور، ذخیره‌سازی SQLite، لاگ ساخت‌یافته.
- `frontend/`: اپ Next.js با RTL کامل، داشبورد نتایج، بارگذاری ورودی، نمایش وضعیت.
- `PLAN.md`: طرح اجرا
- `ASSUMPTIONS.md`: فرض‌های مستند شده در صورت نیاز

## نکات کیفیت
- تمامی متون رابط کاربری فارسی و راست‌به‌چپ هستند.
- لاگ‌ها شامل `requestId` و ساختار JSON هستند.
- ارکستراسیون چندمرحله‌ای است؛ هر ماژول JSON خروجی خود را با اسکیما دریافت/تولید می‌کند.
